{% extends "page.html" %}

{% block content %}

<div class="container">
		{{ page.html | safe }}
</div>

{% if page.meta['stream'] %}
<div class="container">
		<a href="{{stream_source}}" class="btn btn-success" role="button">Download Output</a>
    <h2>Output:</h2>
		<pre id="output" class="text-monospace"></pre>
</div>
{% endif %}

{% include "footer.html" %}

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    const outputElement = document.getElementById('output');

    // Establish a connection to the Flask endpoint streaming the output
    const eventSource = new EventSource( '{{ stream_source }}' );

    eventSource.onmessage = function(event) {
        // Append each line of output to the <pre> element
        outputElement.textContent += event.data + '\n';
    };

    eventSource.onerror = function(event) {
        // Handle any errors or close the connection when the script finishes
				console.error("EventSource failed:", event);
        eventSource.close();
    };
</script>
{% endblock %}
